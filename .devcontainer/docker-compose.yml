version: '3'

services:
  app:
    build: 
      context: ../
      dockerfile: Dockerfile.dev

    volumes:
      # This is where VS Code should expect to find your project's source code and the value of "workspaceFolder" in .devcontainer/devcontainer.json
      - ..:/workspace:cached

      # Uncomment the next line to use Docker from inside the container. See https://aka.ms/vscode-remote/samples/docker-from-docker-compose for details.
      # - /var/run/docker.sock:/var/run/docker.sock
      
    # Overrides default command so things don't shut down after the process ends.
    command: /bin/sh -c "while sleep 1000; do :; done" 
  
  rabbitmq:
    build:
      context: ../
      dockerfile: Dockerfile.rabbitmq

  multi-worker-1:
    build:
      context: ../
      dockerfile: Dockerfile.worker
    hostname: multi-worker-1

networks:
  default:
    name: task_queue
    
    # Connect to existing external network
    # external: True